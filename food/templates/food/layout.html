{% extends "layout.html" %}
{% load staticfiles %}

{% block extra_head %}
{{ block.super }}

<!--Jquery-->
<script src="{% static "food/js/jquery-3.1.1.min.js" %}"></script>
<script src="{% static "food/js/bootstrap-toggle.min.js" %}"></script>
<script src="{% static "food/js/jquery-ui.min.js" %}"></script>
<script src="{% static "jquery.csrf.js" %}"></script>

<link href="{% static "food/css/bootstrap2-toggle.min.css" %}" rel="stylesheet">

<script>
$(document).ready(function(){
    $('.map').click(function(){
        var t = $(this)[0];
        $ .ajax({
             url : 'location/',
            type : 'GET',
            data : {'restaurant': t.id},
            success:function(data){
                alert(data['lat'])
                function setMarkers(map){
                   var marker = new google.maps.Marker({
                    animation: google.maps.Animation.DROP,
                    draggable: true,
                    map: map,
                    title: t.id,
                    position:{lat: data['lat'], lng:data['lng']},
                    });
                }
            }
        })
    })

    $('.meal').click(function(){
        var t = $(this)[0];
        var tstr = 'target' + t.id;
        var target = '#'+tstr;
        if ($(target).length==0){
            $.ajax({
            url : 'history/',
            type: 'GET',
            data : {'meal':t.id},
            success:function(data){
                var p = document.createElement('div');
                p.innerHTML = data;
                p.setAttribute('style','display: none');
                p.setAttribute('id',tstr);
                t.append(p);
                $(target).slideDown("slow");
            }
            });
        } else {
            if ($(target).attr("style") == 'display: none;') {
                $(target).slideDown("slow");
            } else {
                $(target).slideUp("slow");
            }
        }
    });

    $('.soldout').click(function() {
            var check_div = $(this).children("div");
            var bool = false;
            if(check_div.attr('class') == "toggle btn btn-primary btn-xs" || check_div.attr('class') == "toggle btn btn-xs btn-primary"){
                bool = true;
            }
            else{
                bool = false;
            }
            var check_input;
            check_input = false;
            check_input = confirm("정말 바꾸시겠습니까?");
            var get_id = $(this).attr('id');
            var get_id_d = get_id.replace("soldout", "");
            var get_id_r = get_id.replace("soldout", "span");
            var get_id_r = "#"+get_id_r;
            if(check_input == true) {
                if (bool == true) {
                    $(get_id_r).attr("style", "text-decoration:line-through");
                }
                else {
                    $(get_id_r).attr("style", "");
                }
                $.ajax({
                    url: 'bool/',
                    type: 'POST',
                    data: {
                        'bool': bool,
                        'meal_pk': get_id_d,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    // complete: function (data) {
                    //     alert("바뀜 성공");
                    // }
                });
            }
            else {
                var toogle_id = "#" + get_id.replace("soldout", "toggle");
                $(toogle_id).bootstrapToggle('toggle');
            }
         });
    });
</script>

{% endblock %}
